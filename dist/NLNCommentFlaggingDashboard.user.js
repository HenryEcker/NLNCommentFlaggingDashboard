// ==UserScript==
// @name        NLN Comment Flagging Dashboard
// @description Find comments which may potentially be no longer needed and place them in a convenient flagging dashboard
// @homepage    https://github.com/HenryEcker/NLNCommentFlaggingDashboard
// @author      Henry Ecker (https://github.com/HenryEcker)
// @version     2.1.1
// @downloadURL https://github.com/HenryEcker/NLNCommentFlaggingDashboard/raw/master/dist/NLNCommentFlaggingDashboard.user.js
// @updateURL   https://github.com/HenryEcker/NLNCommentFlaggingDashboard/raw/master/dist/NLNCommentFlaggingDashboard.user.js
// @include     *://stackoverflow.com/users/flag-summary/15497888?group=4*
// @grant       GM_getValue
// @grant       GM_setValue
// @run-at      document-end
// ==/UserScript==
/* globals $, StackExchange */

(()=>{var e=[,(e,t,n)=>{"use strict";function a(e,t){return new RegExp(e.map((e=>e.source)).join("|"),t)}function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}function o(e){return(new DOMParser).parseFromString(e,"text/html").documentElement.textContent}function s(e,t=2){return`${e.toFixed(t)}%`}function r(e,t){return e.reduce(((e,t)=>e+t.length),0)/t*100}function l(e){return(new Date).getTime()-60*e*60*1e3}function d(e){return`${s(e.noise_ratio)} [${e.blacklist_matches.join(",")}] (${e.link})`}function c(e){return e/1e3+"s"}function p(e,t){return Object.entries(e).reduce(((e,[t,n])=>(e.set(t,n),e)),t)}function u(e){return p(e,new FormData)}function f(e){return p(e,new URLSearchParams)}n.r(t),n.d(t,{calcNoiseRatio:()=>r,capitalise:()=>i,formatCSSDuration:()=>c,formatComment:()=>d,formatPercentage:()=>s,getFormDataFromObject:()=>u,getOffset:()=>l,getURLSearchParamsFromObject:()=>f,htmlDecode:()=>o,mergeRegexes:()=>a})},(e,t,n)=>{"use strict";n.r(t),n.d(t,{FlaggingDashboard:()=>FlaggingDashboard});var a=n(3),i=n(1),o=n(4);class FlaggingDashboard{constructor(e,t,n,a){this.htmlIds={containerDivId:"NLN_Comment_Wrapper",tableId:"NLN_Comment_Reports_Table",tableBodyId:"NLN_Comment_Reports_Table_Body",styleId:"nln-comment-userscript-styles"},this.SO={CSS:{tableContainerDiv:"s-table-container",table:"s-table",buttonPrimary:"s-btn s-btn__primary",buttonGeneral:"s-btn"},HTML:{pendingSpan:'<span class="supernovabg mod-flag-indicator">pending</span>'}},this.mountPoint=e,this.fkey=t,this.uiConfig=n,this.toaster=a,this.tableData={}}init(){this.buildBaseStyles(),this.buildBaseUI()}buildBaseStyles(){const e=document.createElement("style");e.setAttribute("id",this.htmlIds.styleId),e.innerHTML=`\n#${this.htmlIds.containerDivId} {\n    padding: 25px 0;\n    display: grid;\n    grid-template-rows: 40px 1fr 40px;\n    grid-gap: 10px;\n}\n`,document.head.appendChild(e)}buildBaseUI(){const e=$(`<div id="${this.htmlIds.containerDivId}""></div>`);{const t=$('<div class=nln-header"></div>');t.append($("<h2>NLN Comment Flagging Dashboard</h2>")),e.append(t)}{const t=$(`<div class="${this.SO.CSS.tableContainerDiv}"></div>`),n=$(`<table id="${this.htmlIds.tableId}" class="${this.SO.CSS.table}"></table>`),a=$("<thead></thead>"),i=$("<tr></tr>");i.append($("<th>Comment Text</th>")),this.uiConfig.displayPostType&&i.append($("<th>Post Type</th>")),this.uiConfig.displayLink&&i.append($("<th>Link</th>")),this.uiConfig.displayBlacklistMatches&&i.append($("<th>Blacklist Matches</th>")),this.uiConfig.displayNoiseRatio&&i.append($("<th>Noise Ratio</th>")),this.uiConfig.displayFlagUI&&i.append($("<th>Flag</th>")),this.uiConfig.displayCommentDeleteState&&i.append($("<th>Deleted</th>")),i.append($("<th>Clear</th>")),a.append(i),n.append(a),n.append($(`<tbody id="${this.htmlIds.tableBodyId}"></tbody>`)),t.append(n),e.append(t)}{const t=$('<div class="nln-footer"></div>'),n=$(`<button class="${this.SO.CSS.buttonPrimary}">Clear All</button>`);n.on("click",(()=>{this.tableData={},this.render()})),t.append(n),e.append(t)}this.mountPoint.before(e)}render(){const e=$(`#${this.htmlIds.tableBodyId}`);e.empty(),Object.values(this.tableData).forEach((t=>{const n=$("<tr></tr>");if(n.append(`<td>${t.body}</td>`),this.uiConfig.displayPostType&&n.append(`<td>${(0,i.capitalise)(t.post_type)}</td>`),this.uiConfig.displayLink&&n.append(`<td><a href="${t.link}" target="_blank">${t._id}</a></td>`),this.uiConfig.displayBlacklistMatches&&n.append(`<td>${t.blacklist_matches.map((e=>`"${e}"`)).join(", ")}</td>`),this.uiConfig.displayNoiseRatio&&n.append(`<td>${(0,i.formatPercentage)(t.noise_ratio)}</td>`),this.uiConfig.displayFlagUI)if(t.can_flag)if(t.was_flagged)n.append("<td>âœ“</td>");else{const e=$(`<button data-comment-id="${t._id}" class="${this.SO.CSS.buttonPrimary}">Flag</button>`);e.on("click",(()=>{e.text("Flagging..."),this.handleFlagComment(t)}));const a=$("<td></td>");a.append(e),n.append(a)}else n.append("<td>ðŸš«</td>");this.uiConfig.displayCommentDeleteState&&(void 0!==t.was_deleted?t.was_deleted?n.append("<td>âœ“</td>"):n.append(`<td>${this.SO.HTML.pendingSpan}</td>`):n.append("<td></td>"));{const e=$(`<button class="${this.SO.CSS.buttonGeneral}">Clear</button>`);e.on("click",(()=>this.removeComment(t._id)));const a=$("<td></td>");a.append(e),n.append(a)}e.prepend(n)})),this.updatePageTitle()}handleFlagComment(e){(0,o.flagComment)(this.fkey,e).then((e=>{this.tableData[e._id]=e})).catch((t=>{t instanceof a.RatedLimitedError?this.toaster.open("Flagging too fast!","error"):t instanceof a.FlagAttemptFailed&&(this.toaster.open(t.message,"error",8e3),this.tableData[e._id].can_flag=!1)})).finally((()=>{this.render()}))}addComment(e){this.tableData[e._id]=e,this.render()}removeComment(e){delete this.tableData[e],this.render()}updatePageTitle(){if(this.uiConfig.shouldUpdateTitle){const e=Object.values(this.tableData).reduce(((e,t)=>t.can_flag&&!t.was_flagged?e+1:e),0);let t=document.title.replace(/^\(\d+\)\s+/,"");e>0&&(t=`(${e}) ${t}`),document.title=t}}}},(e,t,n)=>{"use strict";n.r(t),n.d(t,{FlagAttemptFailed:()=>FlagAttemptFailed,RatedLimitedError:()=>RatedLimitedError});class SelfNamedError extends Error{constructor(e){super(e),this.name=this.constructor.name}}class FlagAttemptFailed extends SelfNamedError{}class RatedLimitedError extends SelfNamedError{}},(e,t,n)=>{"use strict";n.r(t),n.d(t,{flagComment:()=>r,getComments:()=>o,getFlagQuota:()=>s});var a=n(1),i=n(3);function o(e,t,n,i){const o=(0,a.getURLSearchParamsFromObject)({pagesize:100,order:"desc",sort:"creation",filter:t,fromdate:n,...i&&{todate:i}});return fetch(`https://api.stackexchange.com/2.3/comments?${o.toString()}&${e}`).then((e=>e.json())).then((e=>e))}function s(e){return new Promise(((t,n)=>{$.get(`https://${location.hostname}/flags/comments/${e}/popup`).done((e=>{const n=/you have (\d+) flags left today/i,a=$('div:contains("flags left today")',e).filter(((e,t)=>0===t.childElementCount&&Boolean(t.innerText.match(n)))).last().text().match(n);return t(null!==a?Number(a[1]):0)})).fail((e=>{if(409===e.status)throw new i.RatedLimitedError("You may only load the comment flag dialog every 3 seconds");return n()}))}))}function r(e,t){return fetch(`https://${location.hostname}/flags/comments/${t._id}/add/39`,{method:"POST",body:(0,a.getFormDataFromObject)({fkey:e,otherText:"",overrideWarning:!0})}).then((e=>{if(409===e.status)throw new i.RatedLimitedError("You can only flag once every 5 seconds");if(200===e.status)return e.json()})).then((e=>{if(e.Success&&0===e.Outcome)t.was_flagged=!0,t.was_deleted=e.ResultChangedState;else if(!e.Success&&2===e.Outcome)if("You have already flagged this comment"===e.Message)t.was_flagged=!0,t.was_deleted=!1;else if("This comment is deleted and cannot be flagged"===e.Message)t.can_flag=!1,t.was_flagged=!1,t.was_deleted=!0;else{if(!e.Message.toLowerCase().includes("out of flag"))throw new i.FlagAttemptFailed(e.Message);t.can_flag=!1,t.was_flagged=!1}return t}))}},(e,t,n)=>{"use strict";n.r(t),n.d(t,{FlagAttemptFailed:()=>FlagAttemptFailed,RatedLimitedError:()=>RatedLimitedError,blacklist:()=>i,whitelist:()=>o});var a=n(1);const i=(0,a.mergeRegexes)([/(?:[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/,/\s+((?=[!-~])[\W_]){2,}\s*/,/\b(?:t(?:y(?:sm|vm)?|hx)|ily(?:sm)?|k)\b/,/(?:happy|glad)\s*(?:\w+\s+)*?(he(?:ar|lp))/,/(?:you(r|['â€™]?re|\s+are)?|that['â€™]?s?)\s+(?:a(?:\s+rock\s+star|mazing|wesome)|incredible|brilliant|wonderful|rock|perfect)[.!]?/,/(?:Any\s+help\s+would\s+be\s+(?:a(?:ppreciated|wesome)|wonderful|great))/,/((?:\w+\s+)*?(?:looking\s*for)|that['â€™]?s?\s*it)[.!]?/,/(?:happy\s+coding)/,/(it('?s)?|this)\s*((re)?solved?|fix(ed)?)\s*(((m[ey]|the)\s*(issue|problem))|it)/,/\b(?:f(?:riend(?:io|o)?|am)|b(?:ud(?:dy)?|ro)|ma(?:te|n)|amigo|homie|dude|pal|sir)\b/,/(?:(?:big\s+|many\s+)?th?ank(?:s|\s*you|\s*u)?(?:\s+a lot|\s+(?:very|so) much|\s+a mil+ion|\s+)?(?:\s*for (?:your|the)?(?:\s+help)?)?|th?anx|thx|cheers)/,/(?:this\s+|that\s+|it\s+)?(?:solution\s+)?work(?:ed|s)?\s*(?:now|perfectly|great|for me|like a charm)?/,/(?:(?:you(?:'?re?|\s+are)\s+)?welcome)+/,/(?:(?:I\s+)?(?:hope\s+)?(?:your\s+|(?:this\s+|that\s+|it\s+)(?:was\s+|is\s+)?)?(?:very\s+)?help(?:ful|ed|s)|useful(?:\s+a lot|\s+(?:very|so) much)?)+/,/(?:perfect|wonderful|brilliant|Excellent|Marvelous|awesome|(?:You\s+)?saved\s+m[ey])/,/(?:You(?:'re|\s*are)\s+)?a\s+life\s+saver/,/(?:please(?:\s+\w+)*\s+)?accept(?:ed|ing)?\b(?:\s+the\s+answer)?/,/(?:please(?:\s+\w+)\s+)?(?:give an?\s+)?upvot(?:ed?|ing)(?:\s+the answer)?/],"gi"),o=(0,a.mergeRegexes)([/\b(?:n(?:eed|ot)|unfortunate(ly)?|persists?|require|but|unaccept(ed)?)\b/,/(?:d(?:o(?:esn(?:'t?|â€™t?|t)|n(?:'t?|â€™t?|t))|idn(?:'t?|â€™t?|t))|c(?:ouldn(?:'t?|â€™t?|t)|an(?:'t?|â€™t?|t))|ha(?:ven(?:'t?|â€™t?|t)|sn(?:'t?|â€™t?|t))|a(?:ren(?:'t?|â€™t?|t)|in(?:'t?|â€™t?|t))|shouldn(?:'t?|â€™t?|t)|wouldn(?:'t?|â€™t?|t)|isn(?:'t?|â€™t?|t))/,/\b(will|I'?ll)\s*try\b/,/[?]/],"gi");class SelfNamedError extends Error{constructor(e){super(e),this.name=this.constructor.name}}class FlagAttemptFailed extends SelfNamedError{}class RatedLimitedError extends SelfNamedError{}},e=>{function t(){arguments.length&&(n(this,arguments),this.onInit())}function n(e,t){if(void 0===e.fields&&(e.fields={},e.onInit=e.onInit||function(){},e.onOpen=e.onOpen||function(){},e.onSave=e.onSave||function(){},e.onClose=e.onClose||function(){},e.onReset=e.onReset||function(){},e.isOpen=!1,e.title="User Script Settings",e.css={basic:["#GM_config * { font-family: arial,tahoma,myriad pro,sans-serif; }","#GM_config { background: #FFF; }","#GM_config input[type='radio'] { margin-right: 8px; }","#GM_config .indent40 { margin-left: 40%; }","#GM_config .field_label { font-size: 12px; font-weight: bold; margin-right: 6px; }","#GM_config .radio_label { font-size: 12px; }","#GM_config .block { display: block; }","#GM_config .saveclose_buttons { margin: 16px 10px 10px; padding: 2px 12px; }","#GM_config .reset, #GM_config .reset a, #GM_config_buttons_holder { color: #000; text-align: right; }","#GM_config .config_header { font-size: 20pt; margin: 0; }","#GM_config .config_desc, #GM_config .section_desc, #GM_config .reset { font-size: 9pt; }","#GM_config .center { text-align: center; }","#GM_config .section_header_holder { margin-top: 8px; }","#GM_config .config_var { margin: 0 0 4px; }","#GM_config .section_header { background: #414141; border: 1px solid #000; color: #FFF;"," font-size: 13pt; margin: 0; }","#GM_config .section_desc { background: #EFEFEF; border: 1px solid #CCC; color: #575757; font-size: 9pt; margin: 0 0 6px; }"].join("\n")+"\n",basicPrefix:"GM_config",stylish:""}),1==t.length&&"string"==typeof t[0].id&&"function"!=typeof t[0].appendChild)var n=t[0];else{n={};for(var a,i=0,o=t.length;i<o;++i)if("function"!=typeof(a=t[i]).appendChild)switch(typeof a){case"object":for(var s in a){if("function"!=typeof a[s]){n.fields=a;break}n.events||(n.events={}),n.events[s]=a[s]}break;case"function":n.events={onOpen:a};break;case"string":/\w+\s*\{\s*\w+\s*:\s*\w+[\s|\S]*\}/.test(a)?n.css=a:n.title=a}else n.frame=a}if(n.id?e.id=n.id:void 0===e.id&&(e.id="GM_config"),n.title&&(e.title=n.title),n.css&&(e.css.stylish=n.css),n.frame&&(e.frame=n.frame),n.events){var r=n.events;for(var d in r)e["on"+d.charAt(0).toUpperCase()+d.slice(1)]=r[d]}if(n.fields){var c=e.read(),p=n.fields,u=n.types||{},f=e.id;for(var h in p){var m=p[h];m?e.fields[h]=new l(m,c[h],h,u[m.type],f):e.fields[h]&&delete e.fields[h]}}e.id!=e.css.basicPrefix&&(e.css.basic=e.css.basic.replace(new RegExp("#"+e.css.basicPrefix,"gm"),"#"+e.id),e.css.basicPrefix=e.id)}var a,i,o,s,r;function l(e,t,n,a,i){this.settings=e,this.id=n,this.configId=i,this.node=null,this.wrapper=null,this.save=void 0===e.save||e.save,"button"==e.type&&(this.save=!1),this.default=void 0===e.default?a?a.default:function(e,t){var n;switch(0==e.indexOf("unsigned ")&&(e=e.substring(9)),e){case"radio":case"select":n=t[0];break;case"checkbox":n=!1;break;case"int":case"integer":case"float":case"number":n=0;break;default:n=""}return n}(e.type,e.options):e.default,this.value=void 0===t?this.default:t,a&&(this.toNode=a.toNode,this.toValue=a.toValue,this.reset=a.reset)}t.prototype={init:function(){n(this,arguments),this.onInit()},open:function(){var e=document.getElementById(this.id);if(!e||!("IFRAME"==e.tagName||e.childNodes.length>0)){var t=this,n="bottom: auto; border: 1px solid #000; display: none; height: 75%; left: 0; margin: 0; max-height: 95%; max-width: 95%; opacity: 0; overflow: auto; padding: 0; position: fixed; right: auto; top: 0; width: 75%; z-index: 9999;";if(this.frame)this.frame.id=this.id,this.frame.setAttribute("style",n),i(this.frame,this.frame.ownerDocument.getElementsByTagName("head")[0]);else{document.body.appendChild(this.frame=this.create("iframe",{id:this.id,style:n})),this.frame.src="about:blank";var a=this;this.frame.addEventListener("load",(function(e){var n=t.frame;n.src&&!n.contentDocument?n.src="":n.contentDocument||a.log("GM_config failed to initialize default settings dialog node!");var o=n.contentDocument.getElementsByTagName("body")[0];o.id=t.id,i(o,n.contentDocument.getElementsByTagName("head")[0])}),!1)}}function i(e,n){var a=t.create,i=t.fields,o=t.id,s=a("div",{id:o+"_wrapper"});n.appendChild(a("style",{type:"text/css",textContent:t.css.basic+t.css.stylish})),s.appendChild(a("div",{id:o+"_header",className:"config_header block center"},t.title));var r=s,l=0;for(var d in i){var c=i[d],p=c.settings;p.section&&(r=s.appendChild(a("div",{className:"section_header_holder",id:o+"_section_"+l})),"[object Array]"!==Object.prototype.toString.call(p.section)&&(p.section=[p.section]),p.section[0]&&r.appendChild(a("div",{className:"section_header center",id:o+"_section_header_"+l},p.section[0])),p.section[1]&&r.appendChild(a("p",{className:"section_desc center",id:o+"_section_desc_"+l},p.section[1])),++l),r.appendChild(c.wrapper=c.toNode())}s.appendChild(a("div",{id:o+"_buttons_holder"},a("button",{id:o+"_saveBtn",textContent:"Save",title:"Save settings",className:"saveclose_buttons",onclick:function(){t.save()}}),a("button",{id:o+"_closeBtn",textContent:"Close",title:"Close window",className:"saveclose_buttons",onclick:function(){t.close()}}),a("div",{className:"reset_holder block"},a("a",{id:o+"_resetLink",textContent:"Reset to defaults",href:"#",title:"Reset fields to default values",className:"reset",onclick:function(e){e.preventDefault(),t.reset()}})))),e.appendChild(s),t.center(),window.addEventListener("resize",t.center,!1),t.onOpen(t.frame.contentDocument||t.frame.ownerDocument,t.frame.contentWindow||window,t.frame),window.addEventListener("beforeunload",(function(){t.close()}),!1),t.frame.style.display="block",t.isOpen=!0}},save:function(){var e=this.write();this.onSave(e)},close:function(){this.frame.contentDocument?(this.remove(this.frame),this.frame=null):(this.frame.innerHTML="",this.frame.style.display="none");var e=this.fields;for(var t in e){var n=e[t];n.wrapper=null,n.node=null}this.onClose(),this.isOpen=!1},set:function(e,t){this.fields[e].value=t,this.fields[e].node&&this.fields[e].reload()},get:function(e,t){var n=this.fields[e],a=null;return t&&n.node&&(a=n.toValue()),null!=a?a:n.value},write:function(e,t){if(!t){var n={},a={},i=this.fields;for(var o in i){var s=i[o],r=s.toValue();s.save?null!=r?(n[o]=r,s.value=r):n[o]=s.value:a[o]=r}}try{this.setValue(e||this.id,this.stringify(t||n))}catch(e){this.log("GM_config failed to save settings!")}return a},read:function(e){try{var t=this.parser(this.getValue(e||this.id,"{}"))}catch(e){this.log("GM_config failed to read saved settings!");t={}}return t},reset:function(){var e=this.fields;for(var t in e)e[t].reset();this.onReset()},create:function(){if(1===arguments.length)var e=document.createTextNode(arguments[0]);else{e=document.createElement(arguments[0]);var t=arguments[1];for(var n in t)0==n.indexOf("on")?e.addEventListener(n.substring(2),t[n],!1):-1!=",style,accesskey,id,name,src,href,which,for".indexOf(","+n.toLowerCase())?e.setAttribute(n,t[n]):e[n]=t[n];if("string"==typeof arguments[2])e.innerHTML=arguments[2];else for(var a=2,i=arguments.length;a<i;++a)e.appendChild(arguments[a])}return e},center:function(){var e=this.frame;if(e){var t=e.style;t.opacity;"none"==t.display&&(t.opacity="0"),t.display="",t.top=Math.floor(window.innerHeight/2-e.offsetHeight/2)+"px",t.left=Math.floor(window.innerWidth/2-e.offsetWidth/2)+"px",t.opacity="1"}},remove:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},(r="undefined"!=typeof GM_getValue&&void 0!==GM_getValue("a","b"))?(a=GM_setValue,i=GM_getValue,o="undefined"==typeof JSON?function(e){return e.toSource()}:JSON.stringify,s="undefined"==typeof JSON?function(e){return new Function("return "+e+";")()}:JSON.parse):(a=function(e,t){return localStorage.setItem(e,t)},i=function(e,t){var n=localStorage.getItem(e);return n??t},o=JSON.stringify,s=JSON.parse),t.prototype.isGM=r,t.prototype.setValue=a,t.prototype.getValue=i,t.prototype.stringify=o,t.prototype.parser=s,t.prototype.log=window.console?console.log:r&&"undefined"!=typeof GM_log?GM_log:window.opera?opera.postError:function(){},l.prototype={create:t.prototype.create,toNode:function(){var e=this.settings,t=this.value,n=e.options,a=e.type,i=this.id,o=this.configId,s=e.labelPos,r=this.create;function l(e,t,n,a){switch(a||(a=n.firstChild),e){case"right":case"below":"below"==e&&n.appendChild(r("br",{})),n.appendChild(t);break;default:"above"==e&&n.insertBefore(r("br",{}),a),n.insertBefore(t,a)}}var d,c=r("div",{className:"config_var",id:o+"_"+i+"_var",title:e.title||""});for(var p in e){d=p;break}var u=e.label&&"button"!=a?r("label",{id:o+"_"+i+"_field_label",for:o+"_field_"+i,className:"field_label"},e.label):null;switch(a){case"textarea":c.appendChild(this.node=r("textarea",{innerHTML:t,id:o+"_field_"+i,className:"block",cols:e.cols?e.cols:20,rows:e.rows?e.rows:2}));break;case"radio":var f=r("div",{id:o+"_field_"+i});this.node=f;p=0;for(var h=n.length;p<h;++p){var m=r("label",{className:"radio_label"},n[p]),g=f.appendChild(r("input",{value:n[p],type:"radio",name:i,checked:n[p]==t}));l(!s||"left"!=s&&"right"!=s?"options"==d?"left":"right":s,m,f,g)}c.appendChild(f);break;case"select":f=r("select",{id:o+"_field_"+i});this.node=f;for(p=0,h=n.length;p<h;++p){var b=n[p];f.appendChild(r("option",{value:b,selected:b==t},b))}c.appendChild(f);break;default:var v={id:o+"_field_"+i,type:a,value:"button"==a?e.label:t};switch(a){case"checkbox":v.checked=t;break;case"button":v.size=e.size?e.size:25,e.script&&(e.click=e.script),e.click&&(v.onclick=e.click);break;case"hidden":break;default:v.type="text",v.size=e.size?e.size:25}c.appendChild(this.node=r("input",v))}return u&&(s||(s="label"==d||"radio"==a?"left":"right"),l(s,u,c)),c},toValue:function(){var e=this.node,t=this.settings,n=t.type,a=!1,i=null;if(!e)return i;switch(0==n.indexOf("unsigned ")&&(n=n.substring(9),a=!0),n){case"checkbox":i=e.checked;break;case"select":i=e[e.selectedIndex].value;break;case"radio":for(var o=e.getElementsByTagName("input"),s=0,r=o.length;s<r;++s)o[s].checked&&(i=o[s].value);break;case"button":break;case"int":case"integer":case"float":case"number":var l=Number(e.value),d='Field labeled "'+t.label+'" expects a'+(a?" positive ":"n ")+"integer value";if(isNaN(l)||"int"==n.substr(0,3)&&Math.ceil(l)!=Math.floor(l)||a&&l<0)return alert(d+"."),null;if(!this._checkNumberRange(l,d))return null;i=l;break;default:i=e.value}return i},reset:function(){var e=this.node,t=this.settings.type;if(e)switch(t){case"checkbox":e.checked=this.default;break;case"select":for(var n=0,a=e.options.length;n<a;++n)e.options[n].textContent==this.default&&(e.selectedIndex=n);break;case"radio":var i=e.getElementsByTagName("input");for(n=0,a=i.length;n<a;++n)i[n].value==this.default&&(i[n].checked=!0);break;case"button":break;default:e.value=this.default}},remove:function(e){t.prototype.remove(e||this.wrapper),this.wrapper=null,this.node=null},reload:function(){var e=this.wrapper;e&&(e.parentNode.insertBefore(this.wrapper=this.toNode(),e),this.remove(e))},_checkNumberRange:function(e,t){var n=this.settings;return"number"==typeof n.min&&e<n.min?(alert(t+" greater than or equal to "+n.min+"."),null):!("number"==typeof n.max&&e>n.max)||(alert(t+" less than or equal to "+n.max+"."),null)}};const d=new t;e.exports=d},(e,t,n)=>{"use strict";n.r(t),n.d(t,{Toast:()=>Toast});n(8);var a=n(1);class Toast{constructor(e,t=450){this.toastMountPoint=$(`<div id="${e}"></div>`),$("body").append(this.toastMountPoint),this.openCloseDuration=t}open(e,t,n=5e3){const i=$(`<div class="nln-toast open ${t}"></div>`);i.css("animation-duration",(0,a.formatCSSDuration)(this.openCloseDuration));{const t=$(' <div class="toast-content"></div></div>');{const n=$(`<div class="toast-text"><span>${e}</span></div>`);t.append(n)}{const e=$('<div class="toast-close-wrapper"></div>'),n=$('<button title="close" class="toast-close-button">X</button>');n.on("click",(()=>this.close(i))),e.append(n),t.append(e)}i.append(t)}if(void 0!==n){const e=$('<div class="toast-progress-wrapper"></div>'),t=$('<div class="toast-progress"></div>');t.css("animation-delay",(0,a.formatCSSDuration)(this.openCloseDuration)),t.css("animation-duration",(0,a.formatCSSDuration)(n)),e.append(t),i.append(e),window.setTimeout((()=>{this.close(i)}),n+this.openCloseDuration)}this.toastMountPoint.append(i)}close(e){e.removeClass("open"),e.addClass("close"),window.setTimeout((()=>{e.remove()}),this.openCloseDuration)}}},(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var a=n(9),i=n.n(a),o=n(10),s=n.n(o),r=n(11),l=n.n(r),d=n(12),c=n.n(d),p=n(13),u=n.n(p),f=n(14),h=n.n(f),m=n(15),g={};g.styleTagTransform=h(),g.setAttributes=c(),g.insert=l().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=u();i()(m.default,g);const b=m.default&&m.default.locals?m.default.locals:void 0},e=>{"use strict";var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var o={},s=[],r=0;r<e.length;r++){var l=e[r],d=a.base?l[0]+a.base:l[0],c=o[d]||0,p="".concat(d," ").concat(c);o[d]=c+1;var u=n(p),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(f);else{var h=i(f,a);a.byIndex=r,t.splice(r,0,{identifier:p,updater:h,references:1})}s.push(p)}return s}function i(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var o=a(e=e||[],i=i||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var r=n(o[s]);t[r].references--}for(var l=a(e,i),d=0;d<o.length;d++){var c=n(o[d]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}o=l}}},e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,i&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},e=>{"use strict";var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var a=n(16),i=n.n(a),o=n(17),s=n.n(o)()(i());s.push([e.id,".nln-toast {\n  box-sizing: content-box;\n  position: absolute;\n  top: calc(var(--theme-topbar-height) + 10px);\n  left: 50%;\n  border: 1px solid var(--theme-content-border-color);\n  border-radius: 6px;\n  overflow: hidden;\n  color: var(--theme-body-font-color);\n}\n.nln-toast.error {\n  background-color: rgba(255, 0, 0, 0.65);\n}\n.nln-toast.error .toast-progress {\n  background-color: #F00;\n}\n.nln-toast .toast-text {\n  padding: 1em;\n}\n.nln-toast .toast-content {\n  display: grid;\n  grid-template-columns: 1fr 0.25fr;\n}\n.nln-toast .toast-close-wrapper {\n  display: flex;\n  align-content: center;\n  justify-content: center;\n}\n.nln-toast .toast-close-button {\n  background: none;\n  border: none;\n  cursor: pointer;\n  color: var(--theme-body-font-color);\n}\n.nln-toast .toast-progress-wrapper {\n  width: 100%;\n  height: 10px;\n  border-top: 1px solid var(--theme-content-border-color);\n  background-color: var(--theme-background-color);\n}\n.nln-toast .toast-progress {\n  width: 100%;\n  height: 100%;\n  animation-name: progressAnimate;\n  animation-direction: normal;\n  animation-fill-mode: forwards;\n  animation-timing-function: linear;\n}\n@keyframes progressAnimate {\n  0% {\n    width: 100%;\n  }\n  100% {\n    width: 0;\n  }\n}\n.nln-toast.open {\n  animation-name: fadeInDown;\n  animation-fill-mode: forwards;\n  animation-timing-function: ease-in-out;\n}\n@keyframes fadeUpOut {\n  0% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n  100% {\n    opacity: 0;\n    transform: translateY(-100px);\n  }\n}\n.nln-toast.close {\n  animation-name: fadeUpOut;\n  animation-fill-mode: forwards;\n  animation-timing-function: ease-in-out;\n}\n@keyframes fadeInDown {\n  0% {\n    opacity: 0;\n    transform: translateY(-100px);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}",""]);const r=s},e=>{"use strict";e.exports=function(e){return e[1]}},e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(a)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);a&&s[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),t.push(c))}},t}}],t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={id:a,exports:{}};return e[a](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{"use strict";n.r(a);var e=n(1),t=n(2),i=n(4),o=n(5),s=n(6),r=n.n(s),l=n(7);r().init({id:"NLN_Comment_Config",title:"NLN Comment Flagging Dashboard Settings",fields:{SITE_NAME:{label:"Site Name",section:["API Information (Changes will take affect on page refresh)"],type:"text",default:"stackoverflow"},ACCESS_TOKEN:{label:"Access Token",type:"text"},KEY:{label:"Key",type:"text"},API_QUOTA_LIMIT:{label:"At what API quota should this script stop making new requests",type:"int",default:500},DELAY_BETWEEN_API_CALLS:{label:"How frequently (in seconds) should comments be fetched",type:"unsigned float",min:60,default:180},ACTIVE:{label:"Running",section:["Run Information"],type:"checkbox",default:!1},RUN_IMMEDIATELY:{label:"Should run immediately on entering matched pages",type:"checkbox",default:!1},POST_TYPE:{label:"Types of post to consider",type:"select",options:["all","question","answer"],default:"all"},MAXIMUM_LENGTH_COMMENT:{label:"Maximum length comments to consider",type:"int",min:15,max:600,default:600},HOUR_OFFSET:{label:"How long ago (in hours) should the calls be offset",type:"unsigned float",min:0,default:0},DISPLAY_CERTAINTY:{label:"How certain should the script be to display in UI (out of 100)",type:"unsigned float",min:0,max:100,default:25},FLAG_QUOTA_LIMIT:{label:"Stop flagging with how many remaining comment flags",type:"int",min:0,max:100,default:0},DOCUMENT_TITLE_SHOULD_UPDATE:{label:"Update Title with number of pending comments for review: ",section:["UI Settings (Changes will take affect on page refresh)"],type:"checkbox",default:!0},UI_DISPLAY_POST_TYPE:{label:"Display Type of Post the comment is under: ",type:"checkbox",default:!0},UI_DISPLAY_LINK_TO_COMMENT:{label:"Display Link to Comment: ",type:"checkbox",default:!0},UI_DISPLAY_BLACKLIST_MATCHES:{label:"Display Blacklist Matches: ",type:"checkbox",default:!0},UI_DISPLAY_NOISE_RATIO:{label:"Display Noise Ratio: ",type:"checkbox",default:!0},UI_DISPLAY_FLAG_BUTTON:{label:"Display Flag button: ",type:"checkbox",default:!0},UI_DISPLAY_COMMENT_DELETE_STATE:{label:"Display If comment was deleted or not: ",type:"checkbox",default:!0}}}),function(){const n=r().get("SITE_NAME"),a=r().get("ACCESS_TOKEN"),s=r().get("KEY");n&&a&&s||r().open();const d=`site=${n}&access_token=${a}&key=${s}`,c=1e3*r().get("DELAY_BETWEEN_API_CALLS"),p=$('<span title="NLN Comment Flagging Dashboard Settings" style="font-size:15pt;cursor: pointer;" class="s-topbar--item">âš™</span>');p.on("click",(()=>r().open()));const u=$("<li></li>");u.append(p),$("header ol.s-topbar--content > li:nth-child(2)").after(u);const f=StackExchange.options.user.fkey;let h=Math.floor(((0,e.getOffset)(r().get("HOUR_OFFSET"))-c)/1e3);const m=new l.Toast("NLN-Toast-Container"),g=new t.FlaggingDashboard($("#mainbar"),f,{displayLink:r().get("UI_DISPLAY_LINK_TO_COMMENT"),displayPostType:r().get("UI_DISPLAY_POST_TYPE"),displayNoiseRatio:r().get("UI_DISPLAY_NOISE_RATIO"),displayFlagUI:r().get("UI_DISPLAY_FLAG_BUTTON"),displayBlacklistMatches:r().get("UI_DISPLAY_BLACKLIST_MATCHES"),displayCommentDeleteState:r().get("UI_DISPLAY_COMMENT_DELETE_STATE"),shouldUpdateTitle:r().get("DOCUMENT_TITLE_SHOULD_UPDATE")},m);g.init(),r().get("ACTIVE")&&g.render();const b=async t=>{const n=Math.floor((0,e.getOffset)(r().get("HOUR_OFFSET"))/1e3),a=await(0,i.getComments)(d,"!SVaJvZISgqg34qVVD)",h,n);a.quota_remaining<=r().get("API_QUOTA_LIMIT")?window.clearInterval(t):a.items.length>0&&(h=n+1,a.items.forEach((t=>{if(function(e){const t=r().get("POST_TYPE");return"all"===t||t===e}(t.post_type)&&t.body_markdown.length<=r().get("MAXIMUM_LENGTH_COMMENT")){const n=(0,e.htmlDecode)(t.body_markdown)||"",a=n.replace(/`.*`/g,"").match(o.blacklist);if(a&&!n.match(o.whitelist)){const i=(0,e.calcNoiseRatio)(a,n.replace(/\B@\w+/g,"").length);i>=r().get("DISPLAY_CERTAINTY")&&g.addComment({can_flag:t.can_flag,body:n,link:t.link,_id:t.comment_id,post_id:t.post_id,post_type:t.post_type,blacklist_matches:a,noise_ratio:i})}}})))};if(r().get("ACTIVE")){r().get("RUN_IMMEDIATELY")&&b();const e=window.setInterval((()=>b(e)),c)}}()})()})();